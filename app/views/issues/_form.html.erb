<%= form_with model: issue, url: issue.persisted? ? project_issue_path(@project, issue) : project_issues_path(@project), method: issue.persisted? ? :patch : :post, class: "needs-validation", novalidate: true do |form| %>
  <% if can?(:update, issue, :title) %>
    <div class="mb-3">
      <%= form.label :title, "#{t('title')} <span class='text-danger'>*</span>".html_safe, class: "form-label" %>
      <%= form.text_field :title, class: "form-control" %>
      <% issue.errors.full_messages_for(:title).each do |message| %>
        <div class="text-danger"><%= message %></div>
      <% end %>
    </div>
  <% end %>

  <% if can?(:update, issue, :description) %>
    <div class="mb-3">
      <%= form.label :description, "#{t('description')} <span class='text-danger'>*</span>".html_safe, class: "form-label" %>
      <%= form.text_area :description, class: "form-control" %>
      <% issue.errors.full_messages_for(:description).each do |message| %>
        <div class="text-danger"><%= message %></div>
      <% end %>
    </div>
  <% end %>

  <% if can?(:update, issue, :complexity_point) %>
    <div class="mb-3">
      <%= form.label :complexity_point, "#{t('complexity_point')} <span class='text-danger'>*</span>".html_safe,  class: "form-label" %>
      <%= form.number_field :complexity_point, step: '0.01', class: "form-control" %>
      <% @issue.errors.full_messages_for(:complexity_point).each do |message| %>
        <div class="text-danger"><%= message %></div>
      <% end %>
    </div>
  <% end %>

  <% if can?(:update, issue, :state) %>
    <div class="mb-3">
      <%= form.label :state, class: "form-label" %>
      <%= form.select :state, options_for_select(@available_states.map { |state| [state.to_s.humanize, state] }, issue.state), {}, class: "form-select" %>
      <% issue.errors.full_messages_for(:state).each do |message| %>
        <div class="text-danger"><%= message %></div>
      <% end %>
    </div>
  <% end %>

  <% if can?(:update, issue, :assignee_id) %>
    <div class="mb-3">
    <%= form.label :assignee_id, t('issue_assignee'), class: "form-label" %>
    <%= form.select :assignee_id, options_for_select([[t(:select_assignee),'']] +  @project_users.map { |user| [user.name, user.id] },  issue.assignee_id ), {}, class: "form-select" %>
    <% issue.errors.full_messages_for(:assignee_id).each do |message| %>
      <div class="text-danger"><%= message %></div>
    <% end %>
    </div>
  <% end %>


  <div class="mb-3 text-center">
    <%= form.submit t(@issue.new_record? ? 'issues.create' : 'issues.edit'), class: 'btn btn-primary', style: 'width: 50%;' %>
  </div>
<% end %>
